{% extends "dashboard_base.html" %}

{% block title %}CodeSoftix Edit Task{% endblock %}

{% block dashboard_content %}
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Page Header -->

    <!-- Edit Task Card -->
    <div class="card bg-white rounded-lg shadow-md border border-gray-400 max-w-lg mx-auto">
        <div class="card-header p-6 border-b border-gray-400 bg-gradient-to-r from-gray-50 to-white">
            <h3 class="text-lg sm:text-xl font-serif font-semibold text-navy-800 flex items-center">
                <i class="fas fa-tasks mr-3 text-navy-700"></i> Edit Task
            </h3>
        </div>
        <div class="p-6">
            <form action="{{ url_for('edit_task', public_id=task.public_id) }}" method="POST" class="space-y-6">
                <input type="hidden" name="csrf_token" value="{{ csrf_token_value }}"/>
                <div class="form-group">
                    <label for="title" class="block text-sm font-medium text-navy-700 font-sans">Title</label>
                    <input type="text" class="form-control w-full mt-1 p-2 border border-gray-400 rounded-md text-sm focus:ring-navy-500 focus:border-navy-500 transition-colors duration-200 bg-gray-50" id="title" name="title" value="{{ task.title }}" minlength="3" required aria-describedby="title_help title_error">
                    <small id="title_help" class="text-xs text-gray-500 font-sans">Enter a concise title for the task (minimum 3 characters).</small>
                    <small id="title_error" class="text-xs text-red-500 hidden font-sans">Title must be at least 3 characters long.</small>
                </div>
                <div class="form-group">
                    <label for="description" class="block text-sm font-medium text-navy-700 font-sans">Description</label>
                    <textarea class="form-control w-full mt-1 p-2 border border-gray-400 rounded-md text-sm focus:ring-navy-500 focus:border-navy-500 transition-colors duration-200 bg-gray-50" id="description" name="description" rows="4" minlength="5" required aria-describedby="description_help description_error">{{ task.description }}</textarea>
                    <small id="description_help" class="text-xs text-gray-500 font-sans">Provide details about the task (minimum 5 characters).</small>
                    <small id="description_error" class="text-xs text-red-500 hidden font-sans">Description must be at least 5 characters long.</small>
                </div>
                <div class="form-group">
                    <label for="due_date" class="block text-sm font-medium text-navy-700 font-sans">Due Date</label>
                    <input type="date" class="form-control w-full mt-1 p-2 border border-gray-400 rounded-md text-sm focus:ring-navy-500 focus:border-navy-500 transition-colors duration-200 bg-gray-50" id="due_date" name="due_date" value="{{ task.due_date.strftime('%Y-%m-%d') if task.due_date else '' }}" required aria-describedby="due_date_help due_date_error">
                    <small id="due_date_help" class="text-xs text-gray-500 font-sans">Select the task due date.</small>
                    <small id="due_date_error" class="text-xs text-red-500 hidden font-sans">Due date cannot be in the past.</small>
                </div>
                <button type="submit" class="btn bg-navy-700 text-white px-4 py-2 rounded-md font-medium hover:bg-navy-800 border border-navy-900 shadow-sm transition duration-200 w-full sm:w-auto" aria-label="Update task">Update Task</button>
            </form>
        </div>
    </div>
</div>

<script>
    const form = document.querySelector('form');
    const titleInput = document.getElementById('title');
    const descriptionInput = document.getElementById('description');
    const dueDateInput = document.getElementById('due_date');
    const titleError = document.getElementById('title_error');
    const descriptionError = document.getElementById('description_error');
    const dueDateError = document.getElementById('due_date_error');

    form.addEventListener('submit', function(event) {
        let isValid = true;

        // Validate title
        if (titleInput.value.length < 3) {
            titleInput.setCustomValidity('Title must be at least 3 characters long.');
            titleError.classList.remove('hidden');
            isValid = false;
        } else {
            titleInput.setCustomValidity('');
            titleError.classList.add('hidden');
        }

        // Validate description
        if (descriptionInput.value.length < 5) {
            descriptionInput.setCustomValidity('Description must be at least 5 characters long.');
            descriptionError.classList.remove('hidden');
            isValid = false;
        } else {
            descriptionInput.setCustomValidity('');
            descriptionError.classList.add('hidden');
        }

        // Validate due date
        const selectedDate = new Date(dueDateInput.value);
        const now = new Date();
        now.setHours(0, 0, 0, 0);
        if (selectedDate < now) {
            dueDateInput.setCustomValidity('Due date cannot be in the past.');
            dueDateError.classList.remove('hidden');
            isValid = false;
        } else {
            dueDateInput.setCustomValidity('');
            dueDateError.classList.add('hidden');
        }

        if (!isValid) {
            event.preventDefault();
        }
    });

    // Real-time validation
    titleInput.addEventListener('input', function() {
        if (this.value.length < 3) {
            this.setCustomValidity('Title must be at least 3 characters long.');
            titleError.classList.remove('hidden');
        } else {
            this.setCustomValidity('');
            titleError.classList.add('hidden');
        }
    });

    descriptionInput.addEventListener('input', function() {
        if (this.value.length < 5) {
            this.setCustomValidity('Description must be at least 5 characters long.');
            descriptionError.classList.remove('hidden');
        } else {
            this.setCustomValidity('');
            descriptionError.classList.add('hidden');
        }
    });

    dueDateInput.addEventListener('change', function() {
        const selectedDate = new Date(this.value);
        const now = new Date();
        now.setHours(0, 0, 0, 0);
        if (selectedDate < now) {
            this.setCustomValidity('Due date cannot be in the past.');
            dueDateError.classList.remove('hidden');
        } else {
            this.setCustomValidity('');
            dueDateError.classList.add('hidden');
        }
    });
</script>

<style>
.card {
    background: linear-gradient(145deg, #ffffff, #f5f5f5);
    box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.15), -4px -4px 8px rgba(255, 255, 255, 0.9);
}

.btn {
    transition: all 0.2s ease-in-out;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
}

.text-navy-700 {
    color: #2b4a7a;
}

.text-navy-800 {
    color: #1a3555;
}

.text-navy-900 {
    color: #12273f;
}

.bg-navy-500 {
    background-color: #4b6a9a;
}

.bg-navy-700 {
    background-color: #2b4a7a;
}

.bg-navy-800 {
    background-color: #1a3555;
}

.border-navy-500 {
    border-color: #4b6a9a;
}

.border-navy-900 {
    border-color: #12273f;
}

@media (max-width: 640px) {
    .card {
        padding: 1rem;
    }
    h1 {
        font-size: 1.75rem;
    }
    h3 {
        font-size: 1.25rem;
    }
    .form-control {
        font-size: 0.875rem;
    }
    .btn {
        font-size: 0.875rem;
        padding: 0.5rem 1rem;
    }
}

a:focus, input:focus, textarea:focus, button:focus {
    outline: 2px solid #2b4a7a;
    outline-offset: 2px;
}

h1, h3 {
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}
</style>
{% endblock %}